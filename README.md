# NgramIndex

## 仕様

下記2つの機能を有するアプリケーション

### インデックスファイル作成機能
　[郵便番号のCSV](http://www.post.japanpost.jp/zipcode/dl/kogaki/zip/ken_all.zip)をデータソースとし、住所レコードのインデックスファイルを作成する機能


### 検索機能

　入力として、文字列が与えられる。与えられた文字列中の文字をすべて含む住所レコードを上記で作成したインデックスを用いて検索し出力する機能。ただしスペースは文字として扱わない。
※データベースまた検索エンジン利用するのはNG

#### 例１:　入力: 渋谷

出力

"9870113","宮城県","遠田郡涌谷町","渋江"

"0101642","秋田県","秋田市","新屋渋谷町"

"6050874","京都府","京都市東山区","常盤町（東大路通渋谷上る、渋谷通東大路東入、渋谷通東大路東入２丁目、東大路五条下る）"
  ・・・・

注意:下記のような一つのレコードが複数行に分かれている箇所が存在する。これについては別のレコードとして処理してもよいが、結合できることが望ましい。

26105,"605  ","6050874","ｷﾖｳﾄﾌ","ｷﾖｳﾄｼﾋｶﾞｼﾔﾏｸ","ﾄｷﾜﾁﾖｳ","京都府","京都市東山区","常盤町（東大路通渋谷上る、渋谷通東大路東入、渋谷通東大路東入２丁目、",0,0,0,0,0,0

26105,"605  ","6050874","ｷﾖｳﾄﾌ","ｷﾖｳﾄｼﾋｶﾞｼﾔﾏｸ","ﾄｷﾜﾁﾖｳ","京都府","京都市東山区","東大路五条下る）",0,0,0,0,0,0

#### 例２：東京都

東京と京都が含まれている住所レコードが出力されること

---

## 実行説明資料

　コンソールアプリケーションとなっており、起動引数の指定によってインデックスの作成、検索の実行を行うことができます。

### インデックスの作成

　起動引数の指定がない場合はインデックスを作成します。

>NgramIndex

### 検索の実行

　検索を行うには、必ずインデックスの作成を行ってください。
　インデックスの作成が行ってなければ、検索処理は実行できません。

>NgramIndex {検索キーワード}


## 技術説明資料

### プロジェクト構成

+ NgramIndex.csproj			 …… 実行プログラム
+ NgramIndex.Tests.csproj	 …… テストプロジェクト

#### NgramIndex.csprojについて

　コードが肥大化していたため、クラスを分割しています。

　その上で、コンソールアプリケーションですが、Webやデスクトップアプリとしても使いまわせるように、検索のビジネスロジック部分を切り離しています。

### インデックスファイルの仕様について

インデックスファイルは大きくなりがちなので行数の値そのままではなく、間隔で保存しています。
京都を含む行が115,116,117,172だった場合は、

>"京都",115,1,1,55

となります。

これにより、45530KBから24241KBと半分に削減しています。（その後、無駄な行数のダブルクォートを削除して13108KB)

### 使用ライブラリ

+ CsvHelper
+ Nunit
